(this.webpackJsonpsrc=this.webpackJsonpsrc||[]).push([[0],{21:function(e,t,a){e.exports=a(47)},26:function(e,t,a){},27:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},28:function(e,t,a){},47:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(16),s=a.n(o),i=(a(26),a(27),a(28),a(6)),c=a(4),l=a.n(c),h=a(2),u=a(5),d=a(17),m=a(18),p=a(3),b=a(20),f=a(19),g=function(e){Object(b.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).state={token:"",data:{},totalLength:0,currentLength:0,done:!1,running:!1},n.handleChange=n.handleChange.bind(Object(p.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(p.a)(n)),n.makeRequest=n.makeRequest.bind(Object(p.a)(n)),n.finish=n.finish.bind(Object(p.a)(n)),n}return Object(m.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement("input",{value:this.state.token,onChange:this.handleChange,placeholder:"Auth Token"}),r.a.createElement("button",{className:"submit",disabled:this.state.running},"Get Logbook"),r.a.createElement("a",{href:"https://github.com/mtchdev/pf-logbook/blob/master/auth_token.md",target:"_BLANK"},"Learn how to get your auth token")),r.a.createElement("div",{className:"logs"},r.a.createElement("code",null,"Finished ",Object.keys(this.state.data).length," of ",this.state.totalLength," flights"),this.done?r.a.createElement("code",null,"Finished! Your download will start shortly."):""))}},{key:"handleChange",value:function(e){this.setState({token:e.target.value})}},{key:"handleSubmit",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a,n,r,o,s,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!this.state.running){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this.makeRequest("https://api.projectfly.co.uk/api/v3/bookings/logbook?page=0&filter=");case 6:if(!(a=e.sent).data){e.next=43;break}this.setState(Object(h.a)(Object(h.a)({},this.state),{},{running:!0})),e.prev=9,n=Object.values(a.data.data),this.setState(Object(h.a)(Object(h.a)({},this.state),{},{totalLength:a.data.data.length})),console.log("Working..."),r=0;case 14:if(!(r<n.length)){e.next=37;break}return o=n[r],e.prev=16,e.next=19,this.makeRequest("https://api.projectfly.co.uk/api/v3/bookings/".concat(o.id,"/details"));case 19:s=e.sent,i=s.data.data,c=i.flight_number.split("/"),0,this.state.data[o.id]={Booking:{Departure_Icao:i.departure.icao,Arrival_Icao:i.arrival.icao,Status:i.status_code,Callsign:c[0],Flight_Number:c[1],User_Aircraft:0},Flight:{Time_Started:i.flight.time_started,Time_Ended:i.flight.time_ended,Landing_Fpm:i.flight.landing_fpm,Status:2}},e.next=31;break;case 26:return e.prev=26,e.t0=e.catch(16),alert("Something wen't wrong (likely auth token refresh). We've made the file for you anyway."),this.finish(),e.abrupt("return");case 31:console.log("Finished ".concat(r+1," of ").concat(n.length)),r===n.length-1&&this.finish(),this.setState(Object(h.a)(Object(h.a)({},this.state),{},{currentLength:this.state.currentLength+1}));case 34:r++,e.next=14;break;case 37:e.next=43;break;case 40:e.prev=40,e.t1=e.catch(9),alert("No data found.");case 43:e.next=49;break;case 45:e.prev=45,e.t2=e.catch(3),console.error(e.t2),alert("Request Failed: Check console for more information. (Check the auth token?)");case 49:case"end":return e.stop()}}),e,this,[[3,45],[9,40],[16,26]])})));return function(t){return e.apply(this,arguments)}}()},{key:"makeRequest",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.get(t,{headers:{Authorization:"Bearer "+this.state.token}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"finish",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState(Object(h.a)(Object(h.a)({},this.state),{},{running:!1,done:!0})),t=Math.random().toString(36).substr(2,5),a=document.createElement("a"),n=new Blob([JSON.stringify(this.state.data)],{type:"text/plain"}),a.href=URL.createObjectURL(n),a.download="pf_export-".concat(t,".json"),document.body.appendChild(a),a.click();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),a}(r.a.Component);var k=function(){return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("h3",null,"projectFLY Logbook Exporter (",r.a.createElement("strong",null,"STKP"),")"),r.a.createElement("span",{className:"description"},"This web app allows you to export your projectFLY data into the SimToolKitPro format."),r.a.createElement(g,null),r.a.createElement("div",{className:"disclaimer"},r.a.createElement("span",null,"This website is not affiliated with projectFLY."),r.a.createElement("span",null,"Source Code: ",r.a.createElement("a",{href:"https://github.com/mtchdev/pf-logbook",target:"_BLANK"},"GitHub")),r.a.createElement("span",null,"No form data is ever sent to a server or database, all processing is done locally."),r.a.createElement("span",{className:"danger"},r.a.createElement("strong",null,"Never share your auth token with anyone."))),r.a.createElement("div",{className:"thanks"},"Special thanks to mtchdev & AndrewTech & webdes03")))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(k,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[21,1,2]]]);
//# sourceMappingURL=main.d6553f95.chunk.js.map